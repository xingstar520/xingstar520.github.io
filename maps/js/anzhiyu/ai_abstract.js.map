{"version":3,"file":"../../../js/anzhiyu/ai_abstract.js","names":["randomNum","basicWordCount","btnLink","key","AIKey","Referer","AIReferer","gptName","switchBtn","mode","initialMode","GLOBAL_CONFIG","postHeadAiDescription","title","postAI","pageFillDescription","GLOBAL_CONFIG_SITE","prevParam","lastAiRandomIndex","animationRunning","refreshNum","audio","isPaused","summaryID","post_ai","document","querySelector","aiTitleRefreshIcon","aiReadAloudIcon","explanation","aiStr","aiStrLength","delayInit","indexI","indexJ","timeouts","elapsed","observer","IntersectionObserver","entries","isVisible","isIntersecting","setTimeout","innerHTML","charAt","requestAnimationFrame","animate","threshold","aiFunctions","startAI","click","clearTimeouts","disconnect","thumbnail","querySelectorAll","length","cardRecentPost","list","i","item","href","recommendList","window","pjax","loadUrl","location","origin","aiBtnList","timestamp","start","char","delay","test","firstElementChild","removeChild","div","createElement","className","appendChild","style","opacity","forEach","clearTimeout","str","df","observe","async","aiAbstract","num","Math","max","min","options","truncateDescription","trim","substring","requestBody","content","url","requestOptions","method","headers","body","JSON","stringify","console","info","summary","animationInterval","clearInterval","setInterval","animationText","repeat","response","fetch","result","status","json","id","error","aiAbstractTianli","strArr","split","map","randomIndex","floor","random","aiAbstractLocal","Array","from","filter","heading","index","addEventListener","getElementById","display","transitionDuration","transform","param","value","open","anzhiyu","snackbarShow","pause","animation","cssText","play","requestParams","URLSearchParams","audioBlob","blob","audioURL","URL","createObjectURL","Audio","cursor"],"sources":["js/anzhiyu/ai_abstract.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\n  const {\n    randomNum,\n    basicWordCount,\n    btnLink,\n    key: AIKey,\n    Referer: AIReferer,\n    gptName,\n    switchBtn,\n    mode: initialMode,\n  } = GLOBAL_CONFIG.postHeadAiDescription;\n\n  const { title, postAI, pageFillDescription } = GLOBAL_CONFIG_SITE;\n\n  let lastAiRandomIndex = -1;\n  let animationRunning = true;\n  let mode = initialMode;\n  let refreshNum = 0;\n  let prevParam;\n  let audio = null;\n  let isPaused = false;\n  let summaryID = null;\n\n  const post_ai = document.querySelector(\".post-ai-description\");\n  const aiTitleRefreshIcon = post_ai.querySelector(\".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right\");\n  let aiReadAloudIcon = post_ai.querySelector(\".anzhiyu-icon-circle-dot\");\n  const explanation = post_ai.querySelector(\".ai-explanation\");\n\n  let aiStr = \"\";\n  let aiStrLength = \"\";\n  let delayInit = 600;\n  let indexI = 0;\n  let indexJ = 0;\n  let timeouts = [];\n  let elapsed = 0;\n\n  const observer = createIntersectionObserver();\n  const aiFunctions = [introduce, aiTitleRefreshIconClick, aiRecommend, aiGoHome];\n\n  const aiBtnList = post_ai.querySelectorAll(\".ai-btn-item\");\n  const filteredHeadings = Array.from(aiBtnList).filter(heading => heading.id !== \"go-tianli-blog\");\n  filteredHeadings.forEach((item, index) => {\n    item.addEventListener(\"click\", () => {\n      aiFunctions[index]();\n    });\n  });\n\n  document.getElementById(\"ai-tag\").addEventListener(\"click\", onAiTagClick);\n  aiTitleRefreshIcon.addEventListener(\"click\", onAiTitleRefreshIconClick);\n  document.getElementById(\"go-tianli-blog\").addEventListener(\"click\", () => {\n    window.open(btnLink, \"_blank\");\n  });\n  aiReadAloudIcon.addEventListener(\"click\", readAloud);\n\n  async function readAloud() {\n    if (!summaryID) {\n      anzhiyu.snackbarShow(\"摘要还没加载完呢，请稍后。。。\");\n      return;\n    }\n    aiReadAloudIcon = post_ai.querySelector(\".anzhiyu-icon-circle-dot\");\n    aiReadAloudIcon.style.opacity = \"0.2\";\n    if (audio && !isPaused) {\n      audio.pause();\n      isPaused = true;\n      aiReadAloudIcon.style.opacity = \"1\";\n      aiReadAloudIcon.style.animation = \"\";\n      aiReadAloudIcon.style.cssText = \"animation: ''; opacity: 1;cursor: pointer;\";\n      return;\n    }\n\n    if (audio && isPaused) {\n      audio.play();\n      isPaused = false;\n      aiReadAloudIcon.style.cssText = \"animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer\";\n      return;\n    }\n\n    const options = {\n      key: AIKey,\n      Referer: AIReferer,\n    };\n    const requestParams = new URLSearchParams({\n      key: options.key,\n      id: summaryID,\n    });\n\n    const requestOptions = {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Referer: options.Referer,\n      },\n    };\n\n    try {\n      const response = await fetch(`https://summary.tianli0.top/audio?${requestParams}`, requestOptions);\n      if (response.status === 403) {\n        console.error(\"403 refer与key不匹配。\");\n      } else if (response.status === 500) {\n        console.error(\"500 系统内部错误\");\n      } else {\n        const audioBlob = await response.blob();\n        const audioURL = URL.createObjectURL(audioBlob);\n        audio = new Audio(audioURL);\n        audio.play();\n        aiReadAloudIcon.style.cssText = \"animation: breathe .5s linear infinite; opacity: 0.2;cursor: pointer\";\n        audio.addEventListener(\"ended\", () => {\n          audio = null;\n          aiReadAloudIcon.style.opacity = \"1\";\n          aiReadAloudIcon.style.animation = \"\";\n        });\n      }\n    } catch (error) {\n      console.error(\"请求发生错误❎\");\n    }\n  }\n  if (switchBtn) {\n    document.getElementById(\"ai-Toggle\").addEventListener(\"click\", changeShowMode);\n  }\n\n  aiAbstract();\n  showAiBtn();\n\n  function createIntersectionObserver() {\n    return new IntersectionObserver(\n      entries => {\n        let isVisible = entries[0].isIntersecting;\n        animationRunning = isVisible;\n        if (animationRunning) {\n          delayInit = indexI === 0 ? 200 : 20;\n          timeouts[1] = setTimeout(() => {\n            if (indexJ) {\n              indexI = 0;\n              indexJ = 0;\n            }\n            if (indexI === 0) {\n              explanation.innerHTML = aiStr.charAt(0);\n            }\n            requestAnimationFrame(animate);\n          }, delayInit);\n        }\n      },\n      { threshold: 0 }\n    );\n  }\n\n  function animate(timestamp) {\n    if (!animationRunning) {\n      return;\n    }\n    if (!animate.start) animate.start = timestamp;\n    elapsed = timestamp - animate.start;\n    if (elapsed >= 20) {\n      animate.start = timestamp;\n      if (indexI < aiStrLength - 1) {\n        let char = aiStr.charAt(indexI + 1);\n        let delay = /[,.，。!?！？]/.test(char) ? 150 : 20;\n        if (explanation.firstElementChild) {\n          explanation.removeChild(explanation.firstElementChild);\n        }\n        explanation.innerHTML += char;\n        let div = document.createElement(\"div\");\n        div.className = \"ai-cursor\";\n        explanation.appendChild(div);\n        indexI++;\n        if (delay === 150) {\n          post_ai.querySelector(\".ai-explanation .ai-cursor\").style.opacity = \"0.2\";\n        }\n        if (indexI === aiStrLength - 1) {\n          observer.disconnect();\n          explanation.removeChild(explanation.firstElementChild);\n        }\n        timeouts[0] = setTimeout(() => {\n          requestAnimationFrame(animate);\n        }, delay);\n      }\n    } else {\n      requestAnimationFrame(animate);\n    }\n  }\n\n  function clearTimeouts() {\n    if (timeouts.length) {\n      timeouts.forEach(item => {\n        if (item) {\n          clearTimeout(item);\n        }\n      });\n    }\n  }\n\n  function startAI(str, df = true) {\n    indexI = 0;\n    indexJ = 1;\n    clearTimeouts();\n    animationRunning = false;\n    elapsed = 0;\n    observer.disconnect();\n    explanation.innerHTML = df ? \"生成中. . .\" : \"请等待. . .\";\n    aiStr = str;\n    aiStrLength = aiStr.length;\n    observer.observe(post_ai);\n  }\n\n  async function aiAbstract(num = basicWordCount) {\n    if (mode === \"tianli\") {\n      await aiAbstractTianli(num);\n    } else {\n      aiAbstractLocal();\n    }\n  }\n\n  async function aiAbstractTianli(num) {\n    indexI = 0;\n    indexJ = 1;\n    clearTimeouts();\n    animationRunning = false;\n    elapsed = 0;\n    observer.disconnect();\n\n    num = Math.max(10, Math.min(2000, num));\n    const options = {\n      key: AIKey,\n      Referer: AIReferer,\n    };\n    const truncateDescription = (title + pageFillDescription).trim().substring(0, num);\n\n    const requestBody = {\n      key: options.key,\n      content: truncateDescription,\n      url: location.href,\n    };\n\n    const requestOptions = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Referer: options.Referer,\n      },\n      body: JSON.stringify(requestBody),\n    };\n    console.info(truncateDescription.length);\n    try {\n      let animationInterval = null;\n      let summary;\n      if (animationInterval) clearInterval(animationInterval);\n      animationInterval = setInterval(() => {\n        const animationText = \"生成中\" + \".\".repeat(indexJ);\n        explanation.innerHTML = animationText;\n        indexJ = (indexJ % 3) + 1;\n      }, 500);\n      const response = await fetch(`https://summary.tianli0.top/`, requestOptions);\n      let result;\n      if (response.status === 403) {\n        result = {\n          summary: \"403 refer与key不匹配。\",\n        };\n      } else if (response.status === 500) {\n        result = {\n          summary: \"500 系统内部错误\",\n        };\n      } else {\n        result = await response.json();\n      }\n\n      summary = result.summary.trim();\n      summaryID = result.id;\n\n      setTimeout(() => {\n        aiTitleRefreshIcon.style.opacity = \"1\";\n      }, 300);\n      if (summary) {\n        startAI(summary);\n      } else {\n        startAI(\"摘要获取失败!!!请检查Tianli服务是否正常!!!\");\n      }\n      clearInterval(animationInterval);\n    } catch (error) {\n      console.error(error);\n      explanation.innerHTML = \"发生异常\" + error;\n    }\n  }\n\n  function aiAbstractLocal() {\n    const strArr = postAI.split(\",\").map(item => item.trim());\n    if (strArr.length !== 1) {\n      let randomIndex = Math.floor(Math.random() * strArr.length);\n      while (randomIndex === lastAiRandomIndex) {\n        randomIndex = Math.floor(Math.random() * strArr.length);\n      }\n      lastAiRandomIndex = randomIndex;\n      startAI(strArr[randomIndex]);\n    } else {\n      startAI(strArr[0]);\n    }\n    setTimeout(() => {\n      aiTitleRefreshIcon.style.opacity = \"1\";\n    }, 600);\n  }\n\n  function aiRecommend() {\n    indexI = 0;\n    indexJ = 1;\n    clearTimeouts();\n    animationRunning = false;\n    elapsed = 0;\n    explanation.innerHTML = \"生成中. . .\";\n    aiStr = \"\";\n    aiStrLength = \"\";\n    observer.disconnect();\n    timeouts[2] = setTimeout(() => {\n      explanation.innerHTML = recommendList();\n    }, 600);\n  }\n\n  function recommendList() {\n    let thumbnail = document.querySelectorAll(\".relatedPosts-list a\");\n    if (!thumbnail.length) {\n      const cardRecentPost = document.querySelector(\".card-widget.card-recent-post\");\n      if (!cardRecentPost) return \"\";\n\n      thumbnail = cardRecentPost.querySelectorAll(\".aside-list-item a\");\n\n      let list = \"\";\n      for (let i = 0; i < thumbnail.length; i++) {\n        const item = thumbnail[i];\n        list += `<div class=\"ai-recommend-item\"><span class=\"index\">${\n          i + 1\n        }：</span><a href=\"javascript:;\" onclick=\"pjax.loadUrl('${item.href}')\" title=\"${\n          item.title\n        }\" data-pjax-state=\"\">${item.title}</a></div>`;\n      }\n\n      return `很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class=\"ai-recommend\">${list}</div>`;\n    }\n\n    let list = \"\";\n    for (let i = 0; i < thumbnail.length; i++) {\n      const item = thumbnail[i];\n      list += `<div class=\"ai-recommend-item\"><span>推荐${\n        i + 1\n      }：</span><a href=\"javascript:;\" onclick=\"pjax.loadUrl('${item.href}')\" title=\"${\n        item.title\n      }\" data-pjax-state=\"\">${item.title}</a></div>`;\n    }\n\n    return `推荐文章：<br /><div class=\"ai-recommend\">${list}</div>`;\n  }\n\n  function aiGoHome() {\n    startAI(\"正在前往博客主页...\", false);\n    timeouts[2] = setTimeout(() => {\n      if (window.pjax) {\n        pjax.loadUrl(\"/\");\n      } else {\n        location.href = location.origin;\n      }\n    }, 1000);\n  }\n\n  function introduce() {\n    if (mode == \"tianli\") {\n      startAI(\"我是文章辅助AI: TianliGPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。\");\n    } else {\n      startAI(`我是文章辅助AI: ${gptName} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`);\n    }\n  }\n\n  function aiTitleRefreshIconClick() {\n    aiTitleRefreshIcon.click();\n  }\n\n  function onAiTagClick() {\n    if (mode === \"tianli\") {\n      post_ai.querySelectorAll(\".ai-btn-item\").forEach(item => (item.style.display = \"none\"));\n      document.getElementById(\"go-tianli-blog\").style.display = \"block\";\n      startAI(\n        \"你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。\"\n      );\n    } else {\n      post_ai.querySelectorAll(\".ai-btn-item\").forEach(item => (item.style.display = \"block\"));\n      document.getElementById(\"go-tianli-blog\").style.display = \"none\";\n      startAI(\n        `你好，我是本站摘要生成助理${gptName} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`\n      );\n    }\n  }\n\n  function onAiTitleRefreshIconClick() {\n    const truncateDescription = (title + pageFillDescription).trim().substring(0, basicWordCount);\n\n    aiTitleRefreshIcon.style.opacity = \"0.2\";\n    aiTitleRefreshIcon.style.transitionDuration = \"0.3s\";\n    aiTitleRefreshIcon.style.transform = \"rotate(\" + 360 * refreshNum + \"deg)\";\n    if (truncateDescription.length <= basicWordCount) {\n      let param = truncateDescription.length - Math.floor(Math.random() * randomNum);\n      while (param === prevParam || truncateDescription.length - param === prevParam) {\n        param = truncateDescription.length - Math.floor(Math.random() * randomNum);\n      }\n      prevParam = param;\n      aiAbstract(param);\n    } else {\n      let value = Math.floor(Math.random() * randomNum) + basicWordCount;\n      while (value === prevParam || truncateDescription.length - value === prevParam) {\n        value = Math.floor(Math.random() * randomNum) + basicWordCount;\n      }\n      aiAbstract(value);\n    }\n    refreshNum++;\n  }\n\n  function changeShowMode() {\n    mode = mode === \"tianli\" ? \"local\" : \"tianli\";\n    if (mode === \"tianli\") {\n      document.getElementById(\"ai-tag\").innerHTML = \"TianliGPT\";\n\n      aiReadAloudIcon.style.opacity = \"1\";\n      aiReadAloudIcon.style.cursor = \"pointer\";\n    } else {\n      aiReadAloudIcon.style.opacity = \"0\";\n      aiReadAloudIcon.style.cursor = \"auto\";\n      if ((document.getElementById(\"go-tianli-blog\").style.display = \"block\")) {\n        document.querySelectorAll(\".ai-btn-item\").forEach(item => (item.style.display = \"block\"));\n        document.getElementById(\"go-tianli-blog\").style.display = \"none\";\n      }\n      document.getElementById(\"ai-tag\").innerHTML = gptName + \" GPT\";\n    }\n    aiAbstract();\n  }\n\n  function showAiBtn() {\n    if (mode === \"tianli\") {\n      document.getElementById(\"ai-tag\").innerHTML = \"TianliGPT\";\n    } else {\n      document.getElementById(\"ai-tag\").innerHTML = gptName + \" GPT\";\n    }\n  }\n})();\n"]}
{"version":3,"file":"../../../js/anzhiyu/people.js","names":["_toConsumableArray","e","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","r","_arrayLikeToArray","t","Object","prototype","toString","call","slice","constructor","name","Array","from","test","Symbol","iterator","isArray","length","a","_classCallCheck","_defineProperties","enumerable","configurable","writable","defineProperty","key","_createClass","peopleConfig","src","GLOBAL_CONFIG","peoplecanvas","img","rows","cols","randomRange","Math","random","randomIndex","removeFromArray","splice","removeItemFromArray","indexOf","removeRandomFromArray","getRandomFromArray","resetPeep","stage","n","peep","o","i","gsap","parseEase","s","height","width","scaleX","x","y","startX","startY","anchorY","endX","normalWalk","props","timeline","timeScale","to","duration","ease","repeat","yoyo","walks","Peep","image","rect","this","setRect","walk","value","drawArgs","concat","save","translate","scale","drawImage","apply","restore","document","createElement","onload","init","peoplecanvasEl","getElementById","ctx","getContext","undefined","allPeeps","availablePeeps","crowd","createPeeps","resize","ticker","add","render","window","addEventListener","naturalWidth","naturalHeight","push","clientWidth","clientHeight","devicePixelRatio","forEach","kill","initCrowd","addPeepToCrowd","progress","eventCallback","removePeepFromCrowd","sort","removeEventListener","remove","setTimeout"],"sources":["js/anzhiyu/people.js"],"mappings":"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","ignoreList":[],"sourcesContent":["\"use strict\";\nfunction _toConsumableArray(e) {\n  return _arrayWithoutHoles(e) || _iterableToArray(e) || _unsupportedIterableToArray(e) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\n    \"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"\n  );\n}\n\nfunction _unsupportedIterableToArray(e, r) {\n  if (e) {\n    if (\"string\" == typeof e) return _arrayLikeToArray(e, r);\n    var t = Object.prototype.toString.call(e).slice(8, -1);\n    return (\n      \"Object\" === t && e.constructor && (t = e.constructor.name),\n      \"Map\" === t || \"Set\" === t\n        ? Array.from(e)\n        : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)\n        ? _arrayLikeToArray(e, r)\n        : void 0\n    );\n  }\n}\n\nfunction _iterableToArray(e) {\n  if ((\"undefined\" != typeof Symbol && null != e[Symbol.iterator]) || null != e[\"@@iterator\"]) return Array.from(e);\n}\n\nfunction _arrayWithoutHoles(e) {\n  if (Array.isArray(e)) return _arrayLikeToArray(e);\n}\n\nfunction _arrayLikeToArray(e, r) {\n  (null == r || r > e.length) && (r = e.length);\n  for (var t = 0, a = new Array(r); t < r; t++) a[t] = e[t];\n  return a;\n}\n\nfunction _classCallCheck(e, r) {\n  if (!(e instanceof r)) throw new TypeError(\"Cannot call a class as a function\");\n}\n\nfunction _defineProperties(e, r) {\n  for (var t = 0; t < r.length; t++) {\n    var a = r[t];\n    (a.enumerable = a.enumerable || !1),\n      (a.configurable = !0),\n      \"value\" in a && (a.writable = !0),\n      Object.defineProperty(e, a.key, a);\n  }\n}\n\nfunction _createClass(e, r, t) {\n  return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), e;\n}\nvar peopleConfig = {\n    src: GLOBAL_CONFIG.peoplecanvas.img,\n    rows: 15,\n    cols: 7,\n  },\n  randomRange = function (e, r) {\n    return e + Math.random() * (r - e);\n  },\n  randomIndex = function (e) {\n    return 0 | randomRange(0, e.length);\n  },\n  removeFromArray = function (e, r) {\n    return e.splice(r, 1)[0];\n  },\n  removeItemFromArray = function (e, r) {\n    return removeFromArray(e, e.indexOf(r));\n  },\n  removeRandomFromArray = function (e) {\n    return removeFromArray(e, randomIndex(e));\n  },\n  getRandomFromArray = function (e) {\n    return e[0 | randomIndex(e)];\n  },\n  resetPeep = function (e) {\n    var r,\n      t,\n      a = e.stage,\n      n = e.peep,\n      o = 0.5 < Math.random() ? 1 : -1,\n      i = 100 - 250 * gsap.parseEase(\"power2.in\")(Math.random()),\n      s = a.height - n.height + i;\n    return (\n      1 == o ? ((r = -n.width), (t = a.width), (n.scaleX = 1)) : ((r = a.width + n.width), (t = 0), (n.scaleX = -1)),\n      (n.x = r),\n      (n.y = s),\n      {\n        startX: r,\n        startY: (n.anchorY = s),\n        endX: t,\n      }\n    );\n  },\n  normalWalk = function (e) {\n    var r = e.peep,\n      t = e.props,\n      a = (t.startX, t.startY),\n      n = t.endX,\n      o = gsap.timeline();\n    return (\n      o.timeScale(randomRange(0.5, 1.5)),\n      o.to(\n        r,\n        {\n          duration: 10,\n          x: n,\n          ease: \"none\",\n        },\n        0\n      ),\n      o.to(\n        r,\n        {\n          duration: 0.25,\n          repeat: 40,\n          yoyo: !0,\n          y: a - 10,\n        },\n        0\n      ),\n      o\n    );\n  },\n  walks = [normalWalk],\n  Peep = (function () {\n    function a(e) {\n      var r = e.image,\n        t = e.rect;\n      _classCallCheck(this, a),\n        (this.image = r),\n        this.setRect(t),\n        (this.x = 0),\n        (this.y = 0),\n        (this.anchorY = 0),\n        (this.scaleX = 1),\n        (this.walk = null);\n    }\n    return (\n      _createClass(a, [\n        {\n          key: \"setRect\",\n          value: function (e) {\n            (this.rect = e),\n              (this.width = e[2]),\n              (this.height = e[3]),\n              (this.drawArgs = [this.image].concat(_toConsumableArray(e), [0, 0, this.width, this.height]));\n          },\n        },\n        {\n          key: \"render\",\n          value: function (e) {\n            e.save(),\n              e.translate(this.x, this.y),\n              e.scale(this.scaleX, 1),\n              e.drawImage.apply(e, _toConsumableArray(this.drawArgs)),\n              e.restore();\n          },\n        },\n      ]),\n      a\n    );\n  })(),\n  img = document.createElement(\"img\");\n(img.onload = init), (img.src = peopleConfig.src);\nlet peoplecanvasEl = document.getElementById(\"peoplecanvas\");\n\nlet ctx = peoplecanvasEl ? peoplecanvasEl.getContext(\"2d\") : undefined,\n  stage = {\n    width: 0,\n    height: 0,\n  },\n  allPeeps = [],\n  availablePeeps = [],\n  crowd = [];\n\nfunction init() {\n  if (!peoplecanvasEl) return;\n  createPeeps(), resize(), gsap.ticker.add(render), window.addEventListener(\"resize\", resize);\n}\ndocument.addEventListener(\"pjax:success\", e => {\n  peoplecanvasEl = document.getElementById(\"peoplecanvas\");\n  if (peoplecanvasEl) {\n    (ctx = peoplecanvasEl ? peoplecanvasEl.getContext(\"2d\") : undefined), window.removeEventListener(\"resize\", resize);\n    gsap.ticker.remove(render);\n    setTimeout(() => {\n      if (!peoplecanvasEl) return;\n      resize(), gsap.ticker.add(render), window.addEventListener(\"resize\", resize);\n    }, 300);\n  }\n});\n\nfunction createPeeps() {\n  for (\n    var e = peopleConfig.rows,\n      r = peopleConfig.cols,\n      t = e * r,\n      a = img.naturalWidth / e,\n      n = img.naturalHeight / r,\n      o = 0;\n    o < t;\n    o++\n  )\n    allPeeps.push(\n      new Peep({\n        image: img,\n        rect: [(o % e) * a, ((o / e) | 0) * n, a, n],\n      })\n    );\n}\n\nfunction resize() {\n  if (peoplecanvasEl && peoplecanvasEl.clientWidth != 0) {\n    (stage.width = peoplecanvasEl.clientWidth),\n      (stage.height = peoplecanvasEl.clientHeight),\n      (peoplecanvasEl.width = stage.width * devicePixelRatio),\n      (peoplecanvasEl.height = stage.height * devicePixelRatio),\n      crowd.forEach(function (e) {\n        e.walk.kill();\n      }),\n      (crowd.length = 0),\n      (availablePeeps.length = 0),\n      availablePeeps.push.apply(availablePeeps, allPeeps),\n      initCrowd();\n  }\n}\n\nfunction initCrowd() {\n  for (; availablePeeps.length; ) addPeepToCrowd().walk.progress(Math.random());\n}\n\nfunction addPeepToCrowd() {\n  var e = removeRandomFromArray(availablePeeps),\n    r = getRandomFromArray(walks)({\n      peep: e,\n      props: resetPeep({\n        peep: e,\n        stage: stage,\n      }),\n    }).eventCallback(\"onComplete\", function () {\n      removePeepFromCrowd(e), addPeepToCrowd();\n    });\n  return (\n    (e.walk = r),\n    crowd.push(e),\n    crowd.sort(function (e, r) {\n      return e.anchorY - r.anchorY;\n    }),\n    e\n  );\n}\n\nfunction removePeepFromCrowd(e) {\n  removeItemFromArray(crowd, e), availablePeeps.push(e);\n}\n\nfunction render() {\n  if (!peoplecanvasEl) return;\n  (peoplecanvasEl.width = peoplecanvasEl.width),\n    ctx.save(),\n    ctx.scale(devicePixelRatio, devicePixelRatio),\n    crowd.forEach(function (e) {\n      e.render(ctx);\n    }),\n    ctx.restore();\n}\n"]}
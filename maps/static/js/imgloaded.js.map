{"version":3,"file":"../../../static/js/imgloaded.js","names":["ProgressiveLoad","constructor","smallSrc","largeSrc","this","initTpl","container","document","createElement","smallStage","largeStage","smallImg","Image","largeImg","className","appendChild","onload","_onSmallLoaded","bind","_onLargeLoaded","progressiveLoad","src","classList","add","style","backgroundImage","executeLoad","config","target","console","log","isMobile","window","matchMedia","matches","loader","mobileSmallSrc","mobileLargeSrc","children","insertBefore","enableRoutes","initProgressiveLoad","getElementById","contains","onPJAXComplete","addEventListener"],"sources":["static/js/imgloaded.js"],"mappings":"AAIA,MAAMA,gBACF,WAAAC,CAAYC,EAAUC,GACpBC,KAAKF,SAAWA,EAChBE,KAAKD,SAAWA,EAChBC,KAAKC,SACP,CAKA,OAAAA,GACED,KAAKE,UAAYC,SAASC,cAAc,OACxCJ,KAAKK,WAAaF,SAASC,cAAc,OACzCJ,KAAKM,WAAaH,SAASC,cAAc,OACzCJ,KAAKO,SAAW,IAAIC,MACpBR,KAAKS,SAAW,IAAID,MACpBR,KAAKE,UAAUQ,UAAY,eAC3BV,KAAKK,WAAWK,UAAY,iBAC5BV,KAAKM,WAAWI,UAAY,SAC5BV,KAAKE,UAAUS,YAAYX,KAAKK,YAChCL,KAAKE,UAAUS,YAAYX,KAAKM,YAChCN,KAAKO,SAASK,OAASZ,KAAKa,eAAeC,KAAKd,MAChDA,KAAKS,SAASG,OAASZ,KAAKe,eAAeD,KAAKd,KAClD,CAKA,eAAAgB,GACEhB,KAAKO,SAASU,IAAMjB,KAAKF,SACzBE,KAAKS,SAASQ,IAAMjB,KAAKD,QAC3B,CAKA,cAAAgB,GACEf,KAAKM,WAAWY,UAAUC,IAAI,cAC9BnB,KAAKM,WAAWc,MAAMC,gBAAkB,QAAQrB,KAAKD,YACvD,CAKA,cAAAc,GACEb,KAAKK,WAAWa,UAAUC,IAAI,cAC9BnB,KAAKK,WAAWe,MAAMC,gBAAkB,QAAQrB,KAAKF,YACvD,EAGF,MAAMwB,YAAc,CAACC,EAAQC,KAC3BC,QAAQC,IAAI,YACZ,MAAMC,EAAWC,OAAOC,WAAW,sBAAsBC,QACnDC,EAAS,IAAInC,gBACjB+B,EAAWJ,EAAOS,eAAiBT,EAAOzB,SAC1C6B,EAAWJ,EAAOU,eAAiBV,EAAOxB,UAGxCyB,EAAOU,SAAS,IAClBV,EAAOW,aAAaJ,EAAO7B,UAAWsB,EAAOU,SAAS,IAExDH,EAAOf,iBAAiB,EAGpBO,OAAS,CACbzB,SAAU,8EACVC,SAAU,8EACViC,eAAgB,8EAChBC,eAAgB,8EAChBG,aAAc,CAAC,MAGjB,SAASC,oBAAoBd,GAC3B,MAAMC,EAASrB,SAASmC,eAAe,eACnCd,GAAUA,EAAON,UAAUqB,SAAS,cACtCjB,YAAYC,EAAQC,EAExB,CAEA,SAASgB,eAAejB,GACtB,MAAMC,EAASrB,SAASmC,eAAe,eACnCd,GAAUA,EAAON,UAAUqB,SAAS,cACtCF,oBAAoBd,EAExB,CAEApB,SAASsC,iBAAiB,oBAAoB,WAC5CJ,oBAAoBd,OACtB,IAEApB,SAASsC,iBAAiB,iBAAiB,WACzCD,eAAejB,OACjB","ignoreList":[],"sourcesContent":["// 首页头图加载优化\n/**\n * @description 实现medium的渐进加载背景的效果\n */\nclass ProgressiveLoad {\n    constructor(smallSrc, largeSrc) {\n      this.smallSrc = smallSrc;\n      this.largeSrc = largeSrc;\n      this.initTpl();\n    }\n  \n    /**\n     * @description 生成ui模板\n     */\n    initTpl() {\n      this.container = document.createElement('div');\n      this.smallStage = document.createElement('div');\n      this.largeStage = document.createElement('div');\n      this.smallImg = new Image();\n      this.largeImg = new Image();\n      this.container.className = 'pl-container';\n      this.smallStage.className = 'pl-img pl-blur';\n      this.largeStage.className = 'pl-img';\n      this.container.appendChild(this.smallStage);\n      this.container.appendChild(this.largeStage);\n      this.smallImg.onload = this._onSmallLoaded.bind(this);\n      this.largeImg.onload = this._onLargeLoaded.bind(this);\n    }\n  \n    /**\n     * @description 加载背景\n     */\n    progressiveLoad() {\n      this.smallImg.src = this.smallSrc;\n      this.largeImg.src = this.largeSrc;\n    }\n  \n    /**\n     * @description 大图加载完成\n     */\n    _onLargeLoaded() {\n      this.largeStage.classList.add('pl-visible');\n      this.largeStage.style.backgroundImage = `url('${this.largeSrc}')`;\n    }\n  \n    /**\n     * @description 小图加载完成\n     */\n    _onSmallLoaded() {\n      this.smallStage.classList.add('pl-visible');\n      this.smallStage.style.backgroundImage = `url('${this.smallSrc}')`;\n    }\n  }\n  \n  const executeLoad = (config, target) => {\n    console.log('执行渐进背景替换');\n    const isMobile = window.matchMedia('(max-width: 767px)').matches;\n    const loader = new ProgressiveLoad(\n      isMobile ? config.mobileSmallSrc : config.smallSrc,\n      isMobile ? config.mobileLargeSrc : config.largeSrc\n    );\n    // 和背景图颜色保持一致，防止高斯模糊后差异较大\n    if (target.children[0]) {\n      target.insertBefore(loader.container, target.children[0]);\n    }\n    loader.progressiveLoad();\n  };\n  \n  const config = {\n    smallSrc: 'https://api.nsmao.net/api/Img/query?key=nGCZ4lMaQeiypA336PE0iUVNp7&sort=acg', // 小图链接 尽可能配置小于100k的图片\n    largeSrc: 'https://api.nsmao.net/api/Img/query?key=nGCZ4lMaQeiypA336PE0iUVNp7&sort=acg', // 大图链接 最终显示的图片\n    mobileSmallSrc: 'https://api.nsmao.net/api/Img/query?key=nGCZ4lMaQeiypA336PE0iUVNp7&sort=acg', // 手机端小图链接 尽可能配置小于100k的图片\n    mobileLargeSrc: 'https://api.nsmao.net/api/Img/query?key=nGCZ4lMaQeiypA336PE0iUVNp7&sort=acg', // 手机端大图链接 最终显示的图片\n    enableRoutes: ['/'],\n    };\n\n  function initProgressiveLoad(config) {\n    const target = document.getElementById('page-header');\n    if (target && target.classList.contains('full_page')) {\n      executeLoad(config, target);\n    }\n  }\n  \n  function onPJAXComplete(config) {\n    const target = document.getElementById('page-header');\n    if (target && target.classList.contains('full_page')) {\n      initProgressiveLoad(config);\n    }\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", function() {\n    initProgressiveLoad(config);\n  });\n  \n  document.addEventListener(\"pjax:complete\", function() {\n    onPJAXComplete(config);\n  });\n"]}